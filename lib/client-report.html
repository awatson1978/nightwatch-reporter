<body>
  {{> velocity}}
</body>

<template name="velocity">
  <div id="velocityOverlay" class="{{#if overlayIsVisible}}visible{{/if}}">
    <h1 class="velocity-logo">Velocity</h1>

    {{#if resetting}}
      {{> velocityResetNotification}}
    {{/if}}

    {{> velocityControlPanel}}

    {{#each frameworks}}
      {{> velocityReports}}
    {{/each}}

    {{#if active 'showLogs'}}
      <h3>Logs</h3>
      {{> velocityLogs}}
    {{/if}}

    {{#if active 'showFiles'}}
      <h3>Test Files</h3>
      {{> velocityTestFiles}}
    {{/if}}

    {{#if mochaPresent}}
    <div class="iframe {{#if active 'showMochaIframe'}}visible{{/if}}">
      <h3>Mocha iFrame</h3>
      {{> mochaweb}}
    </div>
    {{/if}}
  </div>

  <!-- The status widget is the display-toggle circle in the upper-right -->
  <a id="velocity-status-widget"
     class="{{statusWidgetClass}} display-toggle"
     data-target="velocityOverlay"></a>

</template>

<template name="velocityControlPanel">
  <h1>{{totalPassedTestCount}} tests passed</h1>

  <div class="controls">
    <div class="options">
      <h3>Options</h3>
      <div class="btn-group-vertical">
        <button id="showSuccessful" class="btn  btn-default control-toggle {{showActive "showSuccessful"}}">Show passing tests</button>
        <button id="showLogs" class="btn btn-default control-toggle {{showActive "showLogs"}}">Show logs</button>
        <button id="showFiles" class="btn btn-default control-toggle {{showActive "showFiles"}}">Show files</button>
        {{#if mochaPresent}}
        <button id="showMochaIframe" class="btn btn-default control-toggle {{showActive "showMochaIframe"}}">Show mocha-web iframe</button>
        {{/if}}
        {{#if nightwatchPresent}}
        <button id="runNightwatchTests" class="btn btn-default">Run nightwatch tests</button>
        {{/if}}
      </div>
    </div>
  </div>
</template>

<template name="velocityReports">
  <section class="velocity-report">
    <h2 class="velocity-report-header">
      <span class="velocity-report-name">{{name}}</span>
<!--     {{#if frameworkTotalTestCount}}
  <span class='pull-right framework-results'> {{frameworkPassedTestCount}} of {{frameworkTotalTestCount}} Passed</span>
{{/if}} -->
    </h2>
    <div class="framework">
      {{#unless frameworkTotalTestCount}}
        {{#if noFrameworkFiles}}
          <div class="velocity-notice-inline">
            <p>It appears that you don't have any tests for this framework. Would you like to add some?</p>
            <button class="btn-velocity">Add {{name}} sample tests</button>
          </div>
          {{else}}
          <div>Loading <img src="packages/velocity_html-reporter/lib/spinner.gif" alt="Loading"></div>
        {{/if}}
      {{/unless}}

      {{#each suites}}
        {{#if suiteNotHidden}}
          <h3 class="velocity-suite-header {{suiteStatus}}">
            {{suite}}
          </h3>
          <table class="velocity-result-table">
            <tbody>
            {{#each reports}}
              {{> velocityTestReport}}
            {{/each}}
            </tbody>
          </table>
          {{/if}}
      {{/each}}
    </div>
  </section>
</template>

<template name="velocityTestReport">
  {{#if reportNotHidden}}
    <tr class="velocity-test">
      <td class="velocity-test-name">{{{name}}}</td> {{! XXX triple-stache allows curly quotes, etc. - worth it? }}
      <td class="velocity-test-time">{{time}} ms</td>
    </tr>
    {{#if failed}}
    <tr>
      <td colspan="2">{{failureMessage}}</td>
    </tr>
    <tr>
      <td colspan="2">
        {{#if failureStackTrace}}
          <pre class='stack-trace pre-scrollable'>{{failureStackTrace}}</pre>
        {{/if}}
      </td>
    </tr>
    {{/if}}
  {{/if}}
</template>

<template name='resultLabel'>
  <span class="label {{labelColor result}} result-label">
    <span class="{{glyphiconType result}}"></span>
  </span>
  &nbsp;
</template>

<template name="velocityLogs">
  <table id="velocityLogs" class="table">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Type</th>
        <th>Message</th>
        <th>Framework</th>
      </tr>
    </thead>
    <tbody>
      {{#each logs}}
      {{> velocityLog}}
      {{/each}}
    </tbody>
  </table>
</template>

<template name="velocityLog">
  <tr class="{{result}}">
    <td>{{timestamp}}</td>
    <td>{{type}}</td>
    <td>{{message}}</td>
    <td>{{framework}}</td>
  </tr>
</template>

<template name="velocityTestFiles">
  <table id="velocityTestFiles"
         class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Relative Path</th>
        <th>Target Framework</th>
        <th>Last Modified</th>
      </tr>
    </thead>
    <tbody>
      {{#each testFiles}}
      {{> velocityTestFile}}
      {{/each}}
    </tbody>
  </table>
</template>

<template name="velocityTestFile">
  <tr class="{{result}}">
    <td>{{_id}}</td>
    <td>{{relativePath}}</td>
    <td>{{targetFramework}}</td>
    <td>{{lastModified}}</td>
  </tr>
</template>

<template name="velocityResetNotification">
  <div id="velocityResetNotification">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Please wait</h3>
      </div>
      <div class="panel-body">
        Velocity is updating your files.
      </div>
    </div>
  </div>
</template>
